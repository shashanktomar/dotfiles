#!/bin/bash

#===============================================
#============== Reusable Functions =============
#===============================================

# Check if a directory exists
check_directory() {
  local DIR=$1
  if [ -d "$DIR" ]; then
    print-status "OK" "$DIR exists."
  else
    print-status "ERROR" "$DIR does not exist."
  fi
}

# Check if a file exists
check_file() {
  local FILE=$1
  if [ -f "$FILE" ]; then
    print-status "OK" "$FILE exists."
  else
    print-status "ERROR" "$FILE does not exist."
  fi
}

# Check if GitHub SSH is working
check_github_ssh() {
  ssh -T git@github.com &>/dev/null
  if [ $? -eq 1 ]; then
    print-status "OK" "GitHub SSH is working."
    return 0
  else
    print-status "ERROR" "GitHub SSH is not working."
  fi
}

# Check if 1password cli is logged in
check_onepass_login() {
  if op whomai &>/dev/null; then
    print-status "OK" "1password cli login successful"
  else
    print-status "ERROR" "1password cli is not logged in"
  fi
}

#===============================================
#================ Health Checks ================
#===============================================
gum style \
  --foreground 212 --border-foreground 212 --border double \
  --align left --width 40 --margin "1 2" --padding "1 2" \
  'Host: {{.hostName}}' 'Type: {{.hostType}} machine'

echo "‚ù§Ô∏è Performing Health Checks"
echo ""

echo "üìÅ Directory Checks" | gum style --background "249" --foreground "232"
# Check if ~/work directory exists
check_directory "$HOME/work"

# Check if ~/personal directory exists
check_directory "$HOME/personal"
echo ""

echo "üîí 1Password Checks" | gum style --background "249" --foreground "232"
check_onepass_login
echo ""

echo "üê± Git Checks" | gum style --background "249" --foreground "232"
check_file "$HOME/.gitconfig"
check_github_ssh
echo ""
